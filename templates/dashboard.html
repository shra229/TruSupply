<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Supplier Risk Dashboard | TruSupply</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-white text-gray-900 font-sans">
  <div class="max-w-6xl mx-auto px-6 py-8">
    <h1 class="text-4xl font-extrabold text-indigo-700 mb-6 text-center">üìä Supplier Risk Dashboard</h1>

    <!-- Summary Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-8">
      <div class="bg-gray-100 p-4 rounded-lg shadow">
        <p class="text-sm font-medium">Total Suppliers</p>
        <p class="text-2xl font-bold">{{ total_suppliers }}</p>
      </div>
      <div class="bg-gray-100 p-4 rounded-lg shadow">
        <p class="text-sm font-medium">Average Risk Score</p>
        <p class="text-2xl font-bold">{{ avg_risk_score }}%</p>
      </div>
      <div class="bg-gray-100 p-4 rounded-lg shadow">
        <p class="text-sm font-medium">High Risk Suppliers</p>
        <p class="text-2xl font-bold text-red-500">{{ high_risk_count }}</p>
      </div>
      <div class="bg-gray-100 p-4 rounded-lg shadow">
        <p class="text-sm font-medium">Low Risk Suppliers</p>
        <p class="text-2xl font-bold text-green-600">{{ low_risk_count }}</p>
      </div>
    </div>

    <!-- Risk Score Explanation -->
    <div class="text-sm text-gray-600 mb-6 text-center">
      <p><span class="text-green-600 font-semibold">Low Risk</span>: &lt; 45 |
         <span class="text-yellow-600 font-semibold">Medium Risk</span>: 45‚Äì65 |
         <span class="text-red-600 font-semibold">High Risk</span>: &gt; 65</p>
    </div>

    <!-- Charts -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="bg-white p-4 rounded-lg border shadow-sm">
        <h2 class="text-md font-semibold mb-2 text-center text-indigo-600">Supplier Categories</h2>
        <canvas id="categoryChart"></canvas>
      </div>
      <div class="bg-white p-4 rounded-lg border shadow-sm">
        <h2 class="text-md font-semibold mb-2 text-center text-indigo-600">Average Scores by Category</h2>
        <canvas id="scoreChart"></canvas>
      </div>
      <div class="md:col-span-2 bg-white p-4 rounded-lg border shadow-sm">
        <h2 class="text-md font-semibold mb-2 text-center text-indigo-600">Risk Score Trends</h2>
        <canvas id="lineChart"></canvas>
      </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto bg-white p-4 rounded-lg border shadow-sm">
      <table class="min-w-full text-sm">
        <thead class="bg-indigo-100 text-indigo-700">
          <tr>
            <th class="p-2">Supplier ID</th>
            <th class="p-2">Name</th>
            <th class="p-2">Category</th>
            <th class="p-2">Location</th>
            <th class="p-2">Compliance</th>
            <th class="p-2">Financial</th>
            <th class="p-2">Delivery</th>
            <th class="p-2">Risk Score</th>
          </tr>
        </thead>
        <tbody>
          {% for s in suppliers %}
          <tr class="text-center border-t border-gray-200">
            <td class="p-2">{{ s['Supplier ID'] }}</td>
            <td class="p-2">{{ s['Supplier Name'] }}</td>
            <td class="p-2">{{ s['Category'] }}</td>
            <td class="p-2">{{ s['Location'] }}</td>
            <td class="p-2">{{ s['Compliance Score'] }}%</td>
            <td class="p-2">{{ s['Financial Score'] }}%</td>
            <td class="p-2">{{ s['On-Time Delivery Rate'] }}%</td>
            <td class="p-2 font-semibold">{{ s['Risk Score'] }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Back Link -->
    <div class="mt-8 text-center">
      <a href="{{ url_for('home') }}" class="text-indigo-600 hover:underline text-sm">‚Üê Back to Home</a>
    </div>
  </div>

  <!-- Chart Scripts -->
  <script>
    const categoryChart = new Chart(document.getElementById('categoryChart'), {
      type: 'pie',
      data: {{ category_chart_data | safe }},
    });

    const scoreChart = new Chart(document.getElementById('scoreChart'), {
      type: 'bar',
      data: {{ score_chart_data | safe }},
      options: {
        responsive: true,
        plugins: { legend: { position: 'top' } }
      }
    });

    const lineChart = new Chart(document.getElementById('lineChart'), {
      type: 'line',
      data: {{ line_chart_data | safe }},
      options: {
        responsive: true,
        plugins: { legend: { position: 'top' } }
      }
    });
  </script>
</body>
</html>
